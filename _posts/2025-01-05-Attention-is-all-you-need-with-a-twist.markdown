---
layout: post
read_time: true
show_date: true
title: Attention is all you need with a twist
date:   2025-01-11 17:00:00 +0530
description: Welcome to Transformer Theatre.
img: /posts/20250105/transformer.jpg 
tags: [artificial intelligence,large language model,generative models]
author: Abhinav Thorat
toc: yes
mathjax: yes
---

Imagine stepping into a movie theater, expecting a relaxing evening of cinematic magic. But as soon as you walk in, you realize this is no ordinary theater, this is the **LSTM Theater**. Instead of plush seats arranged in neat rows facing a giant screen, you’re led to a weird, single file line chair arrangement. Each person stares through a tiny peephole, trying to catch a glimpse of the movie.  

The experience only gets stranger. To follow the story, you rely entirely on the person in front of you whispering what they just saw. The catch is to understand the movie You’re expected to jot down notes as fast as you can and pass them along to the person behind you. The result? Chaos.  
<center><img src='./assets/img/posts/20250105/lstm.jpg'></center>

## Here are the shortcomings of this relic system:  

- **One scene at a time** : You can only process the movie frame by frame [**Sequential Processing**].  

- **Gossip gone wrong** : By the time someone in the back hears about the climactic car chase, the action’s over and done [**Vanishing Gradient**].  

- **Memory meltdown** : Keeping track of plot details becomes impossible if the movie is long enough [**Limited Memory Retention**].  

- **Character confusion** : When the mysterious stranger from the first scene reappears in the finale, you’ve already forgotten who they are [**Long-range Dependency**].  

- **Slow motion nightmare** : The theater operates like a single-threaded processor, grinding along one scene at a time [**Limited Parallel Processing**].  

This theater is a maddening relic, functional but incredibly inefficient. Much like its namesake, the **LSTM architecture**, it’s good in some cases but suffers specifically with an information overload, struggling to tell a story with every twist, turn, and moment of suspense.


## Welcome to The Transformer Theatre: A Blockbuster Redefinition of Cinema (and AI)

Welcome to The Transformer Theatre, a revolutionary cinema that's changing how we experience movies! As you step through its grand entrance, 
you'll immediately notice this isn't your grandfather's movie house. Gone are the restrictive peepholes and cramped single-file seating. Instead, you're greeted by a magnificent amphitheater where every viewer
has a perfect view of the entire screen and can freely interact with anyone else in the audience. 
<center><img src='./assets/img/posts/20250105/3.jpg'></center>
<center><small>Generated by Gemini Model with Prompt : Generate an image of Las Vegas Sphere.</small></center>

### The Incredible Positioning System [**Position Encoding**]

As you enter, you receive a special theater pass that's crucial to your experience. This is the theater's ingenious **Position Aware** system:

1. **Numbered Seats**: Each seat has a unique number encoded in a special way:
   - Your seat number is converted into two different patterns: sine and cosine waves
   - These patterns are like musical notes that get higher or lower depending on where you sit
   - Even if you're in seat 100 or seat 1000, you'll still have a unique position pattern relative to your position in the sequence, ensuring the model understands the order and relationships between all viewers

2. **Position-Aware Glasses**: You receive special glasses that combine your position information with what you're watching:
   - Every observation you make about the movie is automatically tagged with your position
   - When discussing the movie, everyone knows exactly which part you're referring to
   - The position information becomes part of every interaction and discussion

This positioning system solves a crucial problem: it helps everyone know where they are in relation to each other and the movie's timeline, making every interaction position-aware.

### The Viewing Experience

Your group of friends represents what we'll refer as **Tokens**, each person being a unit of information, like a word in a sentence. The special glasses you wear aren't just for position awareness; they let you watch both the movie and your fellow viewers simultaneously. This is exactly how the **Attention Mechanism** works, the ability to focus on multiple things at different levels of importance.

During the movie, something fascinating happens. When a dramatic scene unfolds, each person in your group starts doing three things:
- You think about what you want to understand about the scene (**Query**)
- You consider what insights you can offer others (**Key**)
- You note down what you actually observed (**Value**)

This three-way process is **Self-Attention**. It's like everyone in the theater being able to tap into each other's thoughts about the movie, deciding which perspectives are most relevant to their understanding.

### The Interactive Experience

During intermission, your friends naturally split into different discussion circles. One group analyzes the plot twists, another discusses character development, while a third group debates the cinematography. This parallel processing is called **Multi-Head Attention**, different aspects being analyzed simultaneously.

Each viewer keeps a personal notebook [**Feed-Forward Network**] where they process everything they've learned from these various discussions. But here's the clever part, nobody completely overwrites their initial impressions. Instead, they add new insights to their original thoughts, creating what's known as **Residual Connections**.

There's a friendly usher walking around [**Layer Normalization**] making sure no discussion gets too heated or too quiet. They keep conversations balanced, just like how AI systems need to keep their internal values in check.
### Avenger Assemble : Multi-Head Attention at work
Imagine if, instead of just one person in the theater trying to analyze every aspect of the movie, you had a team of specialists. Each specialist focuses on a different element like plot, visuals, sound, or acting and then they combine their insights for a holistic understanding.

The Transformer splits attention into multiple "heads," each analyzing different parts of the input sequence. Each head looks at different relationships between words, such as how a word in one part of
a sentence might relate to another word far away. After analyzing the input independently, the results from all heads are combined, giving the model a nuanced understanding of context and relationships.
This scaling enables the Transformer to extract and represent diverse patterns within the data, making it especially powerful for handling complex language structures.
### The Two-Part Experience
The evening at the Transformer Theatre is split into two main parts:

- The First Half [**Encoder**] : This is where you watch the movie and engage in dynamic discussions with others. Everyone in the theater processes the same movie, analyzing details and forming insights. Think of this as the Encoder's job: it takes the input (the movie) and breaks it down into meaningful components through collective observations.

- The Second Half [**Decoder**] : Now comes the creative part. You write your review of the film. As you write, you refer back to your notes from the first half [using Attention to the Encoder] while also keeping track of the review you’ve already written [**Decoder Self-Attention**].

### The brilliance of the Causal Language Model comes into play:

As you write, you don’t want spoilers from the future! The review you’re crafting must flow logically from one sentence to the next. This mirrors the concept of **Masked Attention** in the decoder. It ensures that when generating the current word, the model only considers words that came before it. For instance, if you’re halfway through a sentence about the plot twist, the model doesn’t "peek" at how the sentence ends, maintaining **causality** in the sequence.
How It All Works Together
The Encoder takes all the rich information from the movie [tokens] and processes it, creating a compressed but meaningful representation of the film’s key elements. The Decoder then uses this representation alongside Masked Attention to craft the review step by step:

While writing each sentence, the Decoder Self-Attention ensures the current word connects logically with the words that precede it.
Simultaneously, the decoder references the encoded movie notes [via Encoder-Decoder Attention] to ensure accuracy and coherence.
This two-part system ensures a smooth, organized review-writing process, just like how the Transformer model excels at tasks like language generation. It combines structured understanding from the encoder with logical, step-by-step storytelling from the decoder.
<center><img src='./assets/img/posts/20250105/absolute.jpg'></center>

### The Magic of Multiple Viewings

The whole experience repeats itself through multiple showings [**Layers**], with each viewing allowing for deeper understanding and more nuanced interpretations. Each time through, the connections between different aspects of the movie become clearer and more refined.

What makes The Transformer Theatre special is how everyone can instantly share thoughts with anyone else in the room. There's no need to pass messages down a row of people, every viewer has a direct line to every other viewer, just like how **Transformer** models can directly connect any piece of information with any other piece.

## The Revolutionary Impact

As you leave The Transformer Theatre, you realize this wasn't just any movie night, it was a perfect demonstration of how modern AI processes information. The collaborative viewing experience, the structured discussions, the careful note-taking, and the thoughtful review-writing process all mirror the sophisticated way **Transformer** architecture processes and understands information. But this is just the beginning; the journey is only starting, and it stretches far beyond what we can imagine.

### GPT: Revolutionizing the Art of Language Modelling

The Generative Pre-trained Models [**GPT**], much like seasoned movie critics, undergo rigorous preparation before they even begin writing their reviews.

- The Pre-training Phase:
   - In this phase, GPT models watch thousands of "movies" (or datasets) from various genres, absorbing intricate patterns, structures, and relationships.

   - They learn how characters interact, how stories unfold, and how subplots tie into larger narratives. This phase is unsupervised, meaning the model observes and learns without explicit instructions, developing a rich understanding of language and context.
  
- The Fine-tuning Phase:
   - Once pre-trained, these models are fine-tuned with specific goals in mind. For instance, they might specialize in writing film reviews, crafting poetry, or even generating business reports.

   - This phase hones their ability to focus on the task at hand, aligning their output with the desired tone and purpose. Nowadays, these are referred to as Agents, though I’m not sure if they’re here to write, compute, or order a martini shaken, not stirred.

### The Role of Attention in GPT Models
Generative Pre-trained Transformers owe their success to the Attention Mechanism, which allows them to analyze and synthesize information with unparalleled efficiency. Here’s how it works in the context of GPT:

- **Context Awareness**: The model remembers and weighs all the relevant parts of a narrative, ensuring coherence and depth.
- **Causal Language Modeling**: GPT models generate text one token at a time, leveraging Masked Attention to maintain logical flow.
Dynamic Understanding: By attending to both immediate and long-range dependencies, they can weave a detailed yet contextually rich responses.

The foundation of all this innovation traces back to the groundbreaking paper ["Attention Is All You Need"](https://ar5iv.org/pdf/1706.03762) by Vaswani et al. This seminal work introduced the Transformer architecture, revolutionizing how machines process and generate language. In the near future, this breakthrough is sure to stand the test of time.